---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Keywords2vec">Keywords2vec<a class="anchor-link" href="#Keywords2vec">&#182;</a></h1><p>A simple and fast way to generate a word2vec model, with multi-word keywords instead of single words.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example-result">Example result<a class="anchor-link" href="#Example-result">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finding similar keywords for "<strong>obesity</strong>"</p>
<table>
<thead><tr>
<th>index</th>
<th>term</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>overweight</td>
</tr>
<tr>
<td>1</td>
<td>obese</td>
</tr>
<tr>
<td>2</td>
<td>physical inactivity</td>
</tr>
<tr>
<td>3</td>
<td>excess weight</td>
</tr>
<tr>
<td>4</td>
<td>obese adults</td>
</tr>
<tr>
<td>5</td>
<td>high bmi</td>
</tr>
<tr>
<td>6</td>
<td>obese adults</td>
</tr>
<tr>
<td>7</td>
<td>obese people</td>
</tr>
<tr>
<td>8</td>
<td>obesity-related outcomes</td>
</tr>
<tr>
<td>9</td>
<td>obesity among children</td>
</tr>
<tr>
<td>10</td>
<td>poor sleep quality</td>
</tr>
<tr>
<td>11</td>
<td>ssbs</td>
</tr>
<tr>
<td>12</td>
<td>obese populations</td>
</tr>
<tr>
<td>13</td>
<td>cardiometabolic risk</td>
</tr>
<tr>
<td>14</td>
<td>abdominal obesity</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install keywords2vec</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets download some example data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_filepath</span> <span class="o">=</span> <span class="s2">&quot;epistemonikos_data_sample.tsv.gz&quot;</span>

<span class="o">!</span>wget <span class="s2">&quot;https://s3.amazonaws.com/episte-labs/epistemonikos_data_sample.tsv.gz&quot;</span> -O <span class="s2">&quot;{data_filepath}&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We create the model. If you need the vectors, take a look <a href="30_main.ipynb">here</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labels</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">similars_tree</span><span class="p">(</span><span class="n">data_filepath</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>processing file: epistemonikos_data_sample.tsv.gz
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='201' class='' max='201', style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [201/201 00:19<00:00]
    </div>
    
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we can get the most similars keywords</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_similars</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;obesity&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;obesity&#39;,
 &#39;overweight&#39;,
 &#39;obese&#39;,
 &#39;physical inactivity&#39;,
 &#39;excess weight&#39;,
 &#39;high bmi&#39;,
 &#39;obese adults&#39;,
 &#39;obese people&#39;,
 &#39;obesity-related outcomes&#39;,
 &#39;obesity among children&#39;,
 &#39;poor sleep quality&#39;,
 &#39;ssbs&#39;,
 &#39;obese populations&#39;,
 &#39;cardiometabolic risk&#39;,
 &#39;abdominal obesity&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_similars</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;heart failure&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;heart failure&#39;,
 &#39;hf&#39;,
 &#39;chf&#39;,
 &#39;chronic heart failure&#39;,
 &#39;reduced ejection fraction&#39;,
 &#39;unstable angina&#39;,
 &#39;peripheral vascular disease&#39;,
 &#39;peripheral arterial disease&#39;,
 &#39;angina&#39;,
 &#39;congestive heart failure&#39;,
 &#39;left ventricular systolic dysfunction&#39;,
 &#39;acute coronary syndrome&#39;,
 &#39;heart failure patients&#39;,
 &#39;acute myocardial infarction&#39;,
 &#39;left ventricular dysfunction&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Motivation">Motivation<a class="anchor-link" href="#Motivation">&#182;</a></h3><p>The idea started in the Epistemonikos database <a href="https://www.epistemonikos.org">www.epistemonikos.org</a>, a database of scientific articles for people making decisions concerning clinical or health-policy questions. In this context the scientific/health language used is complex. You can easily find keywords like:</p>
<ul>
<li>asthma</li>
<li>heart failure</li>
<li>medial compartment knee osteoarthritis</li>
<li>preserved left ventricular systolic function</li>
<li>non-selective non-steroidal anti-inflammatory drugs</li>
</ul>
<p>We tried some approaches to find those keywords, like ngrams, ngrams + tf-idf, identify entities, among others. But we didn't get really good results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Our-approach">Our approach<a class="anchor-link" href="#Our-approach">&#182;</a></h3><p>We found that tokenizing using stopwords + non word characters was really useful for "finding" the keywords. An example:</p>
<ul>
<li>input: "Timing of replacement therapy for acute renal failure after cardiac surgery"</li>
<li>output: [
  "timing",
  "replacement therapy",
  "acute renal failure",
  "cardiac surgery"
]</li>
</ul>
<p>So we basically split the text when we find:</p>
<ul>
<li>a stopword</li>
<li>a non word character(/,!?. etc) (except from - and ')</li>
</ul>
<p>That's it.</p>
<p>But as there were some problem with some keywords that cointain stopwords, like:</p>
<ul>
<li>Vitamin A</li>
<li>Hepatitis A</li>
<li>Web of Science</li>
</ul>
<p>So we decided to add another method (nltk with some grammar definition) to cover most of the cases. To use this, you need to add the parameter <code>keywords_w_stopwords=True</code>, this method is approx 20x slower.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="References">References<a class="anchor-link" href="#References">&#182;</a></h3><p>Seem to be an old idea (2004):</p>
<p><em>Mihalcea, Rada, and Paul Tarau. "Textrank: Bringing order into text." Proceedings of the 2004 conference on empirical methods in natural language processing. 2004.</em></p>
<p>Reading an implementation of textrank, I realize they used stopwords to separate and create the graph. Then I though in using it as tokenizer for word2vec</p>
<p>As pointed by @deliprao in this <a href="https://twitter.com/jeremyphoward/status/1094025901371621376">twitter thread</a>. It's also used by Rake (2010):</p>
<p><em>Rose, Stuart &amp; Engel, Dave &amp; Cramer, Nick &amp; Cowley, Wendy. (2010). Automatic Keyword Extraction from Individual Documents. 10.1002/9780470689646.ch1.</em></p>
<p>As noted by @astent in the Twitter thread, this concept is called chinking (chunking by exclusion)
<a href="https://www.nltk.org/book/ch07.html#Chinking">https://www.nltk.org/book/ch07.html#Chinking</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Multi-lingual">Multi-lingual<a class="anchor-link" href="#Multi-lingual">&#182;</a></h3><p>We worked in an implementation, that could be used in multiple languages. Of course not all languages are sutable for using this approach. We have tried with good results in English, Spanish and Portuguese</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Try-it-online">Try it online<a class="anchor-link" href="#Try-it-online">&#182;</a></h2><p>You can try it <a href="http://54.196.169.11/episte/">here</a> (takes time to load, lowercase only, doesn't work in mobile yet) MPV :)</p>
<p>These embedding were created using 827,341 title/abstract from @epistemonikos database.
With keywords that repeat at least 10 times. The total vocab is 349,080 keywords (really manageable number)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vocab-size">Vocab size<a class="anchor-link" href="#Vocab-size">&#182;</a></h2><p>One of the main benefit of this method, is the size of the vocabulary. 
For example, using keywords that repeat at least 10 times, for the Epistemonikos dataset (827,341 title/abstract), we got the following vocab size:</p>
<table>
<thead><tr>
<th>ngrams</th>
<th>keywords</th>
<th>comp</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>127,824</td>
<td>36%</td>
</tr>
<tr>
<td>1,2</td>
<td>1,360,550</td>
<td>388%</td>
</tr>
<tr>
<td>1-3</td>
<td>3,204,099</td>
<td>914%</td>
</tr>
<tr>
<td>1-4</td>
<td>4,461,930</td>
<td>1,272%</td>
</tr>
<tr>
<td>1-5</td>
<td>5,133,619</td>
<td>1,464%</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>stopword tokenizer</td>
<td>350,529</td>
<td>100%</td>
</tr>
</tbody>
</table>
<p>More information regarding the comparison, take a look to the folder <a href="analyze">analyze</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Credits">Credits<a class="anchor-link" href="#Credits">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This project has been created using <a href="https://github.com/fastai/nbdev">nbdev</a></p>

</div>
</div>
</div>
    {% endraw %}
</div>
 

